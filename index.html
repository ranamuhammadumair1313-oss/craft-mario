<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rana Umair | Mario Fullscreen Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #5c94fc; /* Mario Sky Blue */
            font-family: 'Orbitron', sans-serif;
        }

        canvas {
            display: block;
        }

        /* UI Overlays */
        .ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            color: white;
            text-shadow: 3px 3px 0px #000;
            pointer-events: none;
            z-index: 10;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
        }

        .overlay h2 {
            font-family: 'Press Start 2P';
            font-size: 40px;
            margin-bottom: 20px;
        }

        .btn-retry {
            padding: 15px 40px;
            background: #bc13fe;
            border: none;
            color: white;
            font-size: 20px;
            font-family: 'Orbitron';
            cursor: pointer;
            box-shadow: 0 0 20px #bc13fe;
        }

        .controls-hint {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 12px;
            text-shadow: 1px 1px black;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div class="ui-layer">
        SCORE: <span id="score">0</span><br><br>
        LIVES: <span id="lives">3</span>
    </div>

    <!-- Game Over Screen -->
    <div id="game-over" class="overlay">
        <h2 style="color: #ff3131;">GAME OVER</h2>
        <button class="btn-retry" onclick="resetGame()">TRY AGAIN</button>
    </div>

    <!-- Victory Screen -->
    <div id="victory" class="overlay">
        <h2 style="color: #39ff14;">MISSION COMPLETE!</h2>
        <p style="color: white; font-size: 20px; margin-bottom: 30px;">Rana Umair Reached The End!</p>
        <button class="btn-retry" onclick="resetGame()">PLAY AGAIN</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div class="controls-hint">ARROWS / WASD TO MOVE & JUMP | REACH THE GREEN FLAG TO WIN</div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const livesEl = document.getElementById('lives');

        // Full Screen Setup
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- Audio Engine ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);

            if (type === 'jump') {
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'coin') {
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'win') {
                const notes = [440, 554, 659, 880];
                notes.forEach((f, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.frequency.setValueAtTime(f, audioCtx.currentTime + i * 0.15);
                    g.gain.setValueAtTime(0.1, audioCtx.currentTime + i * 0.15);
                    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.15 + 0.1);
                    o.start(audioCtx.currentTime + i * 0.15); o.stop(audioCtx.currentTime + i * 0.15 + 0.2);
                });
            }
        }

        // --- Game Logic ---
        let score = 0;
        let lives = 3;
        let gameState = 'playing'; // playing, over, won
        const levelWidth = 5000; // Level ki lambayi

        const player = {
            x: 100, y: 0, w: 40, h: 40,
            dx: 0, dy: 0,
            speed: 7, jumpPower: -16,
            grounded: false
        };

        const gravity = 0.8;
        const keys = {};

        // Level Design
        const platforms = [];
        const coins = [];
        const enemies = [];
        const flag = { x: 4800, y: 0, w: 10, h: 300 }; // End Flag

        function initLevel() {
            platforms.length = 0;
            // Ground
            platforms.push({x: 0, y: canvas.height - 60, w: levelWidth, h: 60});
            // Random Platforms
            for(let i=0; i<30; i++) {
                platforms.push({
                    x: 400 + (i * 150), 
                    y: canvas.height - (150 + Math.random() * 200),
                    w: 120, h: 20
                });
                if(Math.random() > 0.5) {
                    coins.push({x: 450 + (i * 150), y: canvas.height - 400, collected: false});
                }
            }
            // Enemies
            enemies.push({x: 600, y: canvas.height - 100, w: 40, h: 40, dx: -3, range: 200, startX: 600});
            enemies.push({x: 1200, y: canvas.height - 100, w: 40, h: 40, dx: -3, range: 300, startX: 1200});
            enemies.push({x: 2000, y: canvas.height - 100, w: 40, h: 40, dx: -4, range: 400, startX: 2000});
        }

        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        function update() {
            if (gameState !== 'playing') return;

            // Movement
            if (keys['ArrowRight'] || keys['KeyD']) player.dx = player.speed;
            else if (keys['ArrowLeft'] || keys['KeyA']) player.dx = -player.speed;
            else player.dx = 0;

            if ((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && player.grounded) {
                player.dy = player.jumpPower;
                player.grounded = false;
                playSound('jump');
            }

            player.dy += gravity;
            player.x += player.dx;
            player.y += player.dy;

            // Boundaries
            if (player.x < 0) player.x = 0;

            // Collision
            player.grounded = false;
            platforms.forEach(p => {
                if (player.x < p.x + p.w && player.x + player.w > p.x &&
                    player.y < p.y + p.h && player.y + player.h > p.y) {
                    if (player.dy > 0) {
                        player.y = p.y - player.h;
                        player.dy = 0;
                        player.grounded = true;
                    }
                }
            });

            // Coins
            coins.forEach(c => {
                if (!c.collected && player.x < c.x + 20 && player.x + player.w > c.x &&
                    player.y < c.y + 20 && player.y + player.h > c.y) {
                    c.collected = true;
                    score += 100;
                    scoreEl.innerText = score;
                    playSound('coin');
                }
            });

            // Enemies
            enemies.forEach(en => {
                en.x += en.dx;
                if (Math.abs(en.x - en.startX) > en.range) en.dx *= -1;
                if (player.x < en.x + en.w && player.x + player.w > en.x &&
                    player.y < en.y + en.h && player.y + player.h > en.y) {
                    if (player.dy > 0 && player.y < en.y) {
                        en.x = -1000; player.dy = -10; score += 200;
                        scoreEl.innerText = score;
                        playSound('coin');
                    } else {
                        die();
                    }
                }
            });

            // WIN CONDITION: Reach the Flag
            if (player.x > flag.x) {
                gameState = 'won';
                document.getElementById('victory').style.display = 'flex';
                playSound('win');
            }

            // Fall off
            if (player.y > canvas.height) die();
        }

        function die() {
            lives--;
            livesEl.innerText = lives;
            if (lives <= 0) {
                gameState = 'over';
                document.getElementById('game-over').style.display = 'flex';
            } else {
                player.x -= 200;
                player.y = 0;
            }
        }

        function resetGame() {
            score = 0; lives = 3; gameState = 'playing';
            scoreEl.innerText = score; livesEl.innerText = lives;
            player.x = 100; player.y = 0;
            document.getElementById('game-over').style.display = 'none';
            document.getElementById('victory').style.display = 'none';
            initLevel();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Camera follow
            let camX = player.x - canvas.width / 3;
            if (camX < 0) camX = 0;
            if (camX > levelWidth - canvas.width) camX = levelWidth - canvas.width;

            ctx.save();
            ctx.translate(-camX, 0);

            // Draw Platforms
            platforms.forEach(p => {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(p.x, p.y, p.w, p.h);
                ctx.fillStyle = '#2ecc71';
                ctx.fillRect(p.x, p.y, p.w, 10); // Grass
            });

            // Draw Flag (The End)
            ctx.fillStyle = 'black';
            ctx.fillRect(flag.x, canvas.height - 360, 10, 300); // Pole
            ctx.fillStyle = '#39ff14';
            ctx.fillRect(flag.x - 40, canvas.height - 360, 40, 30); // Flag

            // Draw Coins
            ctx.fillStyle = '#f1c40f';
            coins.forEach(c => {
                if (!c.collected) {
                    ctx.beginPath();
                    ctx.arc(c.x + 10, c.y + 10, 10, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            // Draw Enemies
            ctx.fillStyle = '#e74c3c';
            enemies.forEach(en => ctx.fillRect(en.x, en.y, en.w, en.h));

            // Draw Player
            ctx.fillStyle = '#ffffff';
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#bc13fe';
            ctx.fillRect(player.x, player.y, player.w, player.h);
            ctx.shadowBlur = 0;

            ctx.restore();

            update();
            requestAnimationFrame(draw);
        }

        initLevel();
        draw();
    </script>
</body>
</html>
